from requests import Session, Response
from aiohttp import ClientSession

from typing import Coroutine

class BaseDephubgoid:
    async def _search(self, **kwargs) -> Coroutine:
        async with ClientSession() as session:
            async with session.post('https://kapal.dephub.go.id/ditkapel_service/data_kapal/api-kapal.php',
                                    data={
                                        'draw': '',
                                        'columns[0][data]': 'NamaKapal',
                                        'columns[0][name]': '',
                                        'columns[0][searchable]': 'true',
                                        'columns[0][orderable]': 'false',
                                        'columns[0][search][value]': '',
                                        'columns[0][search][regex]': 'false',
                                        'columns[1][data]': 'EksNamaKapal',
                                        'columns[1][name]': '',
                                        'columns[1][searchable]': 'true',
                                        'columns[1][orderable]': 'false',
                                        'columns[1][search][value]': '',
                                        'columns[1][search][regex]': 'false',
                                        'columns[2][data]': 'HurufPengenal',
                                        'columns[2][name]': '',
                                        'columns[2][searchable]': 'true',
                                        'columns[2][orderable]': 'false',
                                        'columns[2][search][value]': '',
                                        'columns[2][search][regex]': 'false',
                                        'columns[3][data]': 'JenisDetailKet',
                                        'columns[3][name]': '',
                                        'columns[3][searchable]': 'true',
                                        'columns[3][orderable]': 'false',
                                        'columns[3][search][value]': '',
                                        'columns[3][search][regex]': 'false',
                                        'columns[4][data]': 'NamaPemilik',
                                        'columns[4][name]': '',
                                        'columns[4][searchable]': 'true',
                                        'columns[4][orderable]': 'false',
                                        'columns[4][search][value]': '',
                                        'columns[4][search][regex]': 'false',
                                        'columns[5][data]': 'TandaPendaftaran',
                                        'columns[5][name]': '',
                                        'columns[5][searchable]': 'true',
                                        'columns[5][orderable]': 'false',
                                        'columns[5][search][value]': '',
                                        'columns[5][search][regex]': 'false',
                                        'columns[6][data]': 'Panjang',
                                        'columns[6][name]': '',
                                        'columns[6][searchable]': 'true',
                                        'columns[6][orderable]': 'false',
                                        'columns[6][search][value]': '',
                                        'columns[6][search][regex]': 'false',
                                        'columns[7][data]': 'Lebar',
                                        'columns[7][name]': '',
                                        'columns[7][searchable]': 'true',
                                        'columns[7][orderable]': 'false',
                                        'columns[7][search][value]': '',
                                        'columns[7][search][regex]': 'false',
                                        'columns[8][data]': 'Dalam',
                                        'columns[8][name]': '',
                                        'columns[8][searchable]': 'true',
                                        'columns[8][orderable]': 'false',
                                        'columns[8][search][value]': '',
                                        'columns[8][search][regex]': 'false',
                                        'columns[9][data]': 'LengthOfAll',
                                        'columns[9][name]': '',
                                        'columns[9][searchable]': 'true',
                                        'columns[9][orderable]': 'false',
                                        'columns[9][search][value]': '',
                                        'columns[9][search][regex]': 'false',
                                        'columns[10][data]': 'IsiKotor',
                                        'columns[10][name]': '',
                                        'columns[10][searchable]': 'true',
                                        'columns[10][orderable]': 'false',
                                        'columns[10][search][value]': '',
                                        'columns[10][search][regex]': 'false',
                                        'columns[11][data]': 'IsiBersih',
                                        'columns[11][name]': '',
                                        'columns[11][searchable]': 'true',
                                        'columns[11][orderable]': 'false',
                                        'columns[11][search][value]': '',
                                        'columns[11][search][regex]': 'false',
                                        'columns[12][data]': 'NomorIMO',
                                        'columns[12][name]': '',
                                        'columns[12][searchable]': 'true',
                                        'columns[12][orderable]': 'false',
                                        'columns[12][search][value]': '',
                                        'columns[12][search][regex]': 'false',
                                        'columns[13][data]': 'TahunPembuatan',
                                        'columns[13][name]': '',
                                        'columns[13][searchable]': 'true',
                                        'columns[13][orderable]': 'false',
                                        'columns[13][search][value]': '',
                                        'columns[13][search][regex]': 'false',
                                        'start': (kwargs.get('page') - 1) * (page := kwargs.get('size')),
                                        'length': page,
                                        'search[value]': '',
                                        'search[regex]': 'false',
                                        'no_tanda_pendaftaran': kwargs.get('tpk', ''),
                                        'nama_kapal': kwargs.get('ship_name'),
                                    }) as response:
                response_json: dict = await response.json()
                return (response_json['data'], {'recordsTotal': response_json['recordsTotal'], 'recordsFiltered': response_json['recordsFiltered']})

if(__name__ == '__main__'):
    import asyncio
    data: dict = asyncio.run(BaseDephubgoid()._search(**{
        'page': 2,
        'size': 10,
        'nama_kapal': 'sa'
    }))